#!/usr/bin/env bash

systemctl --user import-environment
dbus-update-activation-environment --systemd --all

ln -sf "/run/user/$(id -u)/sway-ipc.$(id -u).$(pidof sway).sock" "/run/user/$(id -u)/sway-ipc.sock"

swaymsg exec -- systemctl restart --user gnome-keyring.service
swaymsg exec -- systemctl restart --user nextcloud-client.service
swaymsg exec -- systemctl restart --user mako.service
swaymsg exec -- systemctl restart --user mopidy.service
swaymsg exec -- systemctl restart --user emacs.service
swaymsg exec -- systemctl restart --user clipboard-manager.service

swaymsg workspace "4 "
swaymsg exec "em ~/"
sleep 0.5
swaymsg workspace "2 "
swaymsg exec "firefox"
sleep 2
swaymsg workspace "5 "
swaymsg exec foot -- -e "tmuxinator start music"
sleep 0.3
swaymsg workspace "1 "
swaymsg exec foot
sleep 0.3
swaymsg workspace "3 "
swaymsg layout tabbed
swaymsg exec start-comms

swayidle \
    timeout 300 'blur-lock' \
    timeout 600 'swaymsg "output * dpms off"' \
    resume 'swaymsg "output * dpms on"' \
    before-sleep 'blur-lock' &
